name: test

on: push

env:
    POSTGRES_DB: app
    POSTGRES_USER: user
    POSTGRES_PASSWORD: pass
    VITE_API_BASE_URL: http://nginx/api

jobs:
    test:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout Repository
              uses: actions/checkout@v3

            - name: Copy env
              run: |
                cp ./src/.env.testing ./src/.env

            - name: Docker compose up
              run: |
                cd docker
                docker compose --profile test up --build -d

            - name: Prepare dusk
              run: |
                cd docker
                docker compose exec app php artisan dusk:chrome-driver --detect

            - name: Dusk test
              run: |
                cd docker
                docker compose exec app php artisan dusk
